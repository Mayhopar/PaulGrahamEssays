---
import { getCollection, render } from "astro:content";
import ReaderLayout from "../../layouts/ReaderLayout.astro";

export async function getStaticPaths() {
  const essays = (await getCollection("essays"))
    .sort((a, b) => a.data.dateISO.localeCompare(b.data.dateISO));

  return essays.map((essay, index) => ({
    params: { slug: essay.data.slug },
    props: {
      essay,
      allEssays: essays.map((e) => ({ title: e.data.title, slug: e.data.slug, date: e.data.date, readingTime: e.data.readingTime, sourceUrl: e.data.sourceUrl })),
      currentIndex: index,
    },
  }));
}

const { essay, allEssays, currentIndex } = Astro.props;
const { Content } = await render(essay);
---

<ReaderLayout
  title={essay.data.title}
  date={essay.data.date}
  readingTime={essay.data.readingTime}
  sourceUrl={essay.data.sourceUrl}
  slug={essay.data.slug}
  wordCount={essay.data.wordCount}
  allEssays={allEssays}
  currentIndex={currentIndex}
>
  <Content />
</ReaderLayout>
